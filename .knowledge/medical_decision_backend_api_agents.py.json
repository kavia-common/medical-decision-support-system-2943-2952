{"is_source_file": true, "format": "Python", "description": "This file contains source code for the backend of a medical decision support system, including classes PatientAgent and ClinicalAgent which handle patient interactions and clinical recommendations respectively. It processes chat messages, manages session states, and interfaces with storage and retrieval components.", "external_files": ["./utils", "./storage", "./rag"], "external_methods": ["redact_phi", "detect_red_flags", "now_iso", "extract_fields_from_text", "build_acknowledgment", "get_suggestions_for_key", "get_hints_for_key", "build_safety_banner", "transcript_tail"], "published": ["PatientAgent", "ClinicalAgent"], "classes": [{"name": "PatientAgent", "description": "Handles patient interaction, collecting structured health data via chat, redacting PHI, detecting red flags, and managing conversation state."}, {"name": "ClinicalAgent", "description": "Provides clinical decision support by retrieving relevant medical knowledge passages and generating provisional recommendations based on session data."}], "methods": [{"name": "Optional[Dict[str,str]] _next_question(collected: Dict[str, Any])", "description": "Determines the next unanswered question from the predefined set of patient questions.", "scope": "", "scopeKind": ""}, {"name": "Optional[Dict[str,Any]] _last_agent_question(turns: List[Dict[str, Any]])", "description": "Retrieves the last question asked by the agent in the conversation turns.", "scope": "", "scopeKind": ""}, {"name": "Dict[str,Any] handle_message(self, session_id: str, message: str)", "description": "Processes a user message, updates session state, performs redaction and red-flag detection, extracts fields, and determines the next prompt or completion.", "scope": "PatientAgent", "scopeKind": "class"}, {"name": "Dict[str,Any] recommend(self, session_id: str, extra_notes: str = \"\", top_k: int = 3)", "description": "Generates provisional clinical recommendations based on the session's structured data and retrieved medical passages.", "scope": "ClinicalAgent", "scopeKind": "class"}, {"name": "__init__(self, storage: HybridStorage)", "scope": "PatientAgent", "scopeKind": "class", "description": "unavailable"}, {"name": "__init__(self, storage: HybridStorage, vector_store: LocalVectorStore)", "scope": "ClinicalAgent", "scopeKind": "class", "description": "unavailable"}, {"name": "str _build_context(self, session_id: str, extra_notes: str = \"\")", "scope": "ClinicalAgent", "scopeKind": "class", "description": "unavailable"}, {"name": "List[Dict[str,Any]] _retrieve_guidelines(self, query: str, k: int)", "scope": "ClinicalAgent", "scopeKind": "class", "description": "unavailable"}, {"name": "Dict[str,Any] _synthesize_recommendation(self, context: str, passages: List[Dict[str, Any]])", "scope": "ClinicalAgent", "scopeKind": "class", "description": "unavailable"}], "calls": ["redact_phi", "detect_red_flags", "get_latest_note", "extract_fields_from_text", "build_acknowledgment", "get_suggestions_for_key", "get_hints_for_key", "build_safety_banner", "transcript_tail", "now_iso", "save_session_note", "list_files", "similarity_search"], "search-terms": ["PatientAgent", "ClinicalAgent", "red_flags", "structured", "session_id", "recommendation", "session note", "medical_decision_support"], "state": 2, "file_id": 23, "knowledge_revision": 60, "git_revision": "5ecb7ead0df7813a315513751e73f524d30da2f5", "revision_history": [{"47": ""}, {"60": "5ecb7ead0df7813a315513751e73f524d30da2f5"}], "ctags": [{"_type": "tag", "name": "ClinicalAgent", "path": "/home/kavia/workspace/code-generation/medical-decision-support-system-2943-2952/medical_decision_backend/api/agents.py", "pattern": "/^class ClinicalAgent:$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "PATIENT_QUESTIONS", "path": "/home/kavia/workspace/code-generation/medical-decision-support-system-2943-2952/medical_decision_backend/api/agents.py", "pattern": "/^PATIENT_QUESTIONS = [$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "PatientAgent", "path": "/home/kavia/workspace/code-generation/medical-decision-support-system-2943-2952/medical_decision_backend/api/agents.py", "pattern": "/^class PatientAgent:$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "SAFETY_DISCLAIMER", "path": "/home/kavia/workspace/code-generation/medical-decision-support-system-2943-2952/medical_decision_backend/api/agents.py", "pattern": "/^    SAFETY_DISCLAIMER = ($/", "language": "Python", "kind": "variable", "scope": "ClinicalAgent", "scopeKind": "class"}, {"_type": "tag", "name": "__init__", "path": "/home/kavia/workspace/code-generation/medical-decision-support-system-2943-2952/medical_decision_backend/api/agents.py", "pattern": "/^    def __init__(self, storage: HybridStorage):$/", "language": "Python", "kind": "member", "signature": "(self, storage: HybridStorage)", "scope": "PatientAgent", "scopeKind": "class"}, {"_type": "tag", "name": "__init__", "path": "/home/kavia/workspace/code-generation/medical-decision-support-system-2943-2952/medical_decision_backend/api/agents.py", "pattern": "/^    def __init__(self, storage: HybridStorage, vector_store: LocalVectorStore):$/", "language": "Python", "kind": "member", "signature": "(self, storage: HybridStorage, vector_store: LocalVectorStore)", "scope": "ClinicalAgent", "scopeKind": "class"}, {"_type": "tag", "name": "_build_context", "path": "/home/kavia/workspace/code-generation/medical-decision-support-system-2943-2952/medical_decision_backend/api/agents.py", "pattern": "/^    def _build_context(self, session_id: str, extra_notes: str = \"\") -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "member", "signature": "(self, session_id: str, extra_notes: str = \"\")", "scope": "ClinicalAgent", "scopeKind": "class"}, {"_type": "tag", "name": "_last_agent_question", "path": "/home/kavia/workspace/code-generation/medical-decision-support-system-2943-2952/medical_decision_backend/api/agents.py", "pattern": "/^def _last_agent_question(turns: List[Dict[str, Any]]) -> Optional[Dict[str, Any]]:$/", "language": "Python", "typeref": "typename:Optional[Dict[str,Any]]", "kind": "function", "signature": "(turns: List[Dict[str, Any]])"}, {"_type": "tag", "name": "_next_question", "path": "/home/kavia/workspace/code-generation/medical-decision-support-system-2943-2952/medical_decision_backend/api/agents.py", "pattern": "/^def _next_question(collected: Dict[str, Any]) -> Optional[Dict[str, str]]:$/", "language": "Python", "typeref": "typename:Optional[Dict[str,str]]", "kind": "function", "signature": "(collected: Dict[str, Any])"}, {"_type": "tag", "name": "_retrieve_guidelines", "path": "/home/kavia/workspace/code-generation/medical-decision-support-system-2943-2952/medical_decision_backend/api/agents.py", "pattern": "/^    def _retrieve_guidelines(self, query: str, k: int) -> List[Dict[str, Any]]:$/", "language": "Python", "typeref": "typename:List[Dict[str,Any]]", "kind": "member", "signature": "(self, query: str, k: int)", "scope": "ClinicalAgent", "scopeKind": "class"}, {"_type": "tag", "name": "_synthesize_recommendation", "path": "/home/kavia/workspace/code-generation/medical-decision-support-system-2943-2952/medical_decision_backend/api/agents.py", "pattern": "/^    def _synthesize_recommendation(self, context: str, passages: List[Dict[str, Any]]) -> Dict[s/", "language": "Python", "typeref": "typename:Dict[str,Any]", "kind": "member", "signature": "(self, context: str, passages: List[Dict[str, Any]])", "scope": "ClinicalAgent", "scopeKind": "class"}, {"_type": "tag", "name": "handle_message", "path": "/home/kavia/workspace/code-generation/medical-decision-support-system-2943-2952/medical_decision_backend/api/agents.py", "pattern": "/^    def handle_message(self, session_id: str, message: str) -> Dict[str, Any]:$/", "language": "Python", "typeref": "typename:Dict[str,Any]", "kind": "member", "signature": "(self, session_id: str, message: str)", "scope": "PatientAgent", "scopeKind": "class"}, {"_type": "tag", "name": "recommend", "path": "/home/kavia/workspace/code-generation/medical-decision-support-system-2943-2952/medical_decision_backend/api/agents.py", "pattern": "/^    def recommend(self, session_id: str, extra_notes: str = \"\", top_k: int = 3) -> Dict[str, Any/", "language": "Python", "typeref": "typename:Dict[str,Any]", "kind": "member", "signature": "(self, session_id: str, extra_notes: str = \"\", top_k: int = 3)", "scope": "ClinicalAgent", "scopeKind": "class"}], "hash": "1a8736752238af77b5ac3bb446580f1a", "format-version": 4, "code-base-name": "medical_decision_backend", "filename": "medical_decision_backend/api/agents.py", "fields": [{"name": "PATIENT_QUESTIONS = [", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "SAFETY_DISCLAIMER = (", "scope": "ClinicalAgent", "scopeKind": "class", "description": "unavailable"}]}