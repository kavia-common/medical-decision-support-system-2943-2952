{"is_source_file": true, "format": "Python", "description": "This file defines classes and functions for patient interactions and clinical decision support within a medical decision support system. It includes the PatientAgent for collecting structured patient data through chat, the ClinicalAgent for generating provisional recommendations based on retrieved relevant medical passages, and related helper functions and constants.", "external_files": ["./utils", "./storage", "./rag"], "external_methods": ["redact_phi", "detect_red_flags", "now_iso", "HybridStorage.get_latest_note", "HybridStorage.save_session_note", "HybridStorage.list_files", "LocalVectorStore.similarity_search"], "published": ["PatientAgent", "ClinicalAgent"], "classes": [{"name": "PatientAgent", "description": "Handles patient interactions, collecting structured data through chat, redacting PHI, and detecting red flags."}, {"name": "ClinicalAgent", "description": "Provides clinical decision support by retrieving relevant passages and synthesizing provisional recommendations."}], "methods": [{"name": "Optional[Dict[str,str]] _next_question(collected: Dict[str, Any])", "description": "Determines the next unanswered question for patient data collection.", "scope": "", "scopeKind": ""}, {"name": "Dict[str,Any] handle_message(self, session_id: str, message: str)", "description": "Processes a user message, updates conversation state, and prompts the next question or completes data collection.", "scope": "PatientAgent", "scopeKind": "class"}, {"name": "Dict[str,Any] recommend(self, session_id: str, extra_notes: str = \"\", top_k: int = 3)", "description": "Generates a provisional clinical recommendation based on the current session's data and retrieved guidelines.", "scope": "ClinicalAgent", "scopeKind": "class"}, {"name": "__init__(self, storage: HybridStorage)", "scope": "PatientAgent", "scopeKind": "class", "description": "unavailable"}, {"name": "__init__(self, storage: HybridStorage, vector_store: LocalVectorStore)", "scope": "ClinicalAgent", "scopeKind": "class", "description": "unavailable"}, {"name": "str _build_context(self, session_id: str, extra_notes: str = \"\")", "scope": "ClinicalAgent", "scopeKind": "class", "description": "unavailable"}, {"name": "List[Dict[str,Any]] _retrieve_guidelines(self, query: str, k: int)", "scope": "ClinicalAgent", "scopeKind": "class", "description": "unavailable"}, {"name": "Dict[str,Any] _synthesize_recommendation(self, context: str, passages: List[Dict[str, Any]])", "scope": "ClinicalAgent", "scopeKind": "class", "description": "unavailable"}], "calls": ["redact_phi", "detect_red_flags", "now_iso", "HybridStorage.get_latest_note", "HybridStorage.save_session_note", "HybridStorage.list_files", "LocalVectorStore.similarity_search"], "search-terms": ["PatientAgent", "ClinicalAgent", "redact_phi", "similarity_search", "provisional recommendation", "session_id", "medical_decision_support", "structured data collection", "red-flag detection", "guideline retrieval"], "state": 2, "file_id": 23, "knowledge_revision": 47, "git_revision": "", "ctags": [{"_type": "tag", "name": "ClinicalAgent", "path": "/home/kavia/workspace/code-generation/medical-decision-support-system-2943-2952/medical_decision_backend/api/agents.py", "pattern": "/^class ClinicalAgent:$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "PATIENT_QUESTIONS", "path": "/home/kavia/workspace/code-generation/medical-decision-support-system-2943-2952/medical_decision_backend/api/agents.py", "pattern": "/^PATIENT_QUESTIONS = [$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "PatientAgent", "path": "/home/kavia/workspace/code-generation/medical-decision-support-system-2943-2952/medical_decision_backend/api/agents.py", "pattern": "/^class PatientAgent:$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "SAFETY_DISCLAIMER", "path": "/home/kavia/workspace/code-generation/medical-decision-support-system-2943-2952/medical_decision_backend/api/agents.py", "pattern": "/^    SAFETY_DISCLAIMER = ($/", "language": "Python", "kind": "variable", "scope": "ClinicalAgent", "scopeKind": "class"}, {"_type": "tag", "name": "__init__", "path": "/home/kavia/workspace/code-generation/medical-decision-support-system-2943-2952/medical_decision_backend/api/agents.py", "pattern": "/^    def __init__(self, storage: HybridStorage):$/", "language": "Python", "kind": "member", "signature": "(self, storage: HybridStorage)", "scope": "PatientAgent", "scopeKind": "class"}, {"_type": "tag", "name": "__init__", "path": "/home/kavia/workspace/code-generation/medical-decision-support-system-2943-2952/medical_decision_backend/api/agents.py", "pattern": "/^    def __init__(self, storage: HybridStorage, vector_store: LocalVectorStore):$/", "language": "Python", "kind": "member", "signature": "(self, storage: HybridStorage, vector_store: LocalVectorStore)", "scope": "ClinicalAgent", "scopeKind": "class"}, {"_type": "tag", "name": "_build_context", "path": "/home/kavia/workspace/code-generation/medical-decision-support-system-2943-2952/medical_decision_backend/api/agents.py", "pattern": "/^    def _build_context(self, session_id: str, extra_notes: str = \"\") -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "member", "signature": "(self, session_id: str, extra_notes: str = \"\")", "scope": "ClinicalAgent", "scopeKind": "class"}, {"_type": "tag", "name": "_next_question", "path": "/home/kavia/workspace/code-generation/medical-decision-support-system-2943-2952/medical_decision_backend/api/agents.py", "pattern": "/^def _next_question(collected: Dict[str, Any]) -> Optional[Dict[str, str]]:$/", "language": "Python", "typeref": "typename:Optional[Dict[str,str]]", "kind": "function", "signature": "(collected: Dict[str, Any])"}, {"_type": "tag", "name": "_retrieve_guidelines", "path": "/home/kavia/workspace/code-generation/medical-decision-support-system-2943-2952/medical_decision_backend/api/agents.py", "pattern": "/^    def _retrieve_guidelines(self, query: str, k: int) -> List[Dict[str, Any]]:$/", "language": "Python", "typeref": "typename:List[Dict[str,Any]]", "kind": "member", "signature": "(self, query: str, k: int)", "scope": "ClinicalAgent", "scopeKind": "class"}, {"_type": "tag", "name": "_synthesize_recommendation", "path": "/home/kavia/workspace/code-generation/medical-decision-support-system-2943-2952/medical_decision_backend/api/agents.py", "pattern": "/^    def _synthesize_recommendation(self, context: str, passages: List[Dict[str, Any]]) -> Dict[s/", "language": "Python", "typeref": "typename:Dict[str,Any]", "kind": "member", "signature": "(self, context: str, passages: List[Dict[str, Any]])", "scope": "ClinicalAgent", "scopeKind": "class"}, {"_type": "tag", "name": "handle_message", "path": "/home/kavia/workspace/code-generation/medical-decision-support-system-2943-2952/medical_decision_backend/api/agents.py", "pattern": "/^    def handle_message(self, session_id: str, message: str) -> Dict[str, Any]:$/", "language": "Python", "typeref": "typename:Dict[str,Any]", "kind": "member", "signature": "(self, session_id: str, message: str)", "scope": "PatientAgent", "scopeKind": "class"}, {"_type": "tag", "name": "recommend", "path": "/home/kavia/workspace/code-generation/medical-decision-support-system-2943-2952/medical_decision_backend/api/agents.py", "pattern": "/^    def recommend(self, session_id: str, extra_notes: str = \"\", top_k: int = 3) -> Dict[str, Any/", "language": "Python", "typeref": "typename:Dict[str,Any]", "kind": "member", "signature": "(self, session_id: str, extra_notes: str = \"\", top_k: int = 3)", "scope": "ClinicalAgent", "scopeKind": "class"}], "hash": "986002c617c90b0c97356623186a8271", "format-version": 4, "code-base-name": "medical_decision_backend", "filename": "medical_decision_backend/api/agents.py", "fields": [{"name": "PATIENT_QUESTIONS = [", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "SAFETY_DISCLAIMER = (", "scope": "ClinicalAgent", "scopeKind": "class", "description": "unavailable"}], "revision_history": [{"47": ""}]}